---
title : Cat vs Dog
permalink: /catdog/
---

<!DOCTYPE html>
<html lang="en">
{% include head.html %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat vs Dog</title>
    <script src="https://cdn.staticfile.org/vue/2.6.9/vue.min.js"></script>
    <script src="https://cdn.staticfile.org/element-ui/2.15.7/index.min.js"></script>
    <link rel="stylesheet" href="https://cdn.staticfile.org/element-ui/2.15.7/theme-chalk/index.min.css"></link>
</head>
<body style="background: white;">
{% include navbar.html %}
<div id="main">
    <div id="app" class="app">
        <span style="font-size:18px; margin-left: 10px;">Please select an image</span>
        <div class="img-selector">
            <button class="available-button select-button" @click="loadImage(url)" v-for="url in default_image">
                <el-image class="available-img" :src="url" lazy>
                    <div slot="error" class="image-slot">
                        <i class="el-icon-picture-outline"></i>
                    </div>
                </el-image>
            </button>
            <el-button class="available-img available-button" @click="dialog_visible = true">
                <i class="el-icon-plus" style="font-size: 3em;"></i>
            </el-button>
        </div>
        <div style="text-align: center;" v-loading="loading">
            <img v-if="current_img" id="main-img" class="main-img" :src="current_img" @load="onImageLoad" @error="onImageLoadError" crossOrigin="anonymous"/>
            <div v-if="!current_img" style="height: 100px"></div>
        </div>
        <div class="block">
            <span class="tag" :style="{color: value < 50?'#1989FA':'black'}">Cat</span>
            <el-slider
                    class="slider"
                    v-model="value"
                    :marks="marks">
            </el-slider>
            <span class="tag" :style="{color: value > 50?'#1989FA':'black'}">Dog</span>
        </div>
        <div style="width: 100%;margin: 20px 0 20vh 0;text-align: center;">
          <span style="font-size: 18px;">The Probability of Being "Dog"</span>
        </div>

        <el-dialog title="Your Image" :visible.sync="dialog_visible">
            <div>
                <el-input
                        placeholder="Image URL"
                        v-model="url_link"
                        clearable>
                </el-input>
            </div>
            <span slot="footer" class="dialog-footer">
                <el-button @click="dialog_visible = false">Cancel</el-button>
                <el-button :disabled="!url_link" type="primary" @click="dialog_visible = false; loadImage(url_link)">OK</el-button>
            </span>
        </el-dialog>
    </div>
</div>
{% include footer.html %}
<script>
    new Vue({
        el: '#app',
        data: {
            dialog_visible: false,
            loading: false,
            default_image: [
                'https://weai.aishuwen.com/cat_vs_dog/cat.4001.jpg',
                'https://weai.aishuwen.com/cat_vs_dog/cat.4002.jpg',
                'https://weai.aishuwen.com/cat_vs_dog/cat.4003.jpg',
                'https://weai.aishuwen.com/cat_vs_dog/cat.4004.jpg',
                'https://weai.aishuwen.com/cat_vs_dog/dog.4001.jpg',
                'https://weai.aishuwen.com/cat_vs_dog/dog.4002.jpg',
                'https://weai.aishuwen.com/cat_vs_dog/dog.4003.jpg',
                'https://weai.aishuwen.com/cat_vs_dog/dog.4004.jpg'],
            //backend_url: 'http://127.0.0.1:9000',
            backend_url: 'https://service-mtg8md36-1302242949.gz.apigw.tencentcs.com/release/',
            current_img: '',
            value: 50,
            marks: {
                0: '0',
                10: '0.1',
                20: '0.2',
                30: '0.3',
                40: '0.4',
                50: {
                    style: {
                        color: '#1989FA'
                    },
                    label: '0.5'
                },
                60: '0.6',
                70: '0.7',
                80: '0.8',
                90: '0.9',
                100: '1'
            },
            url_link: null,
            main_img: null,
            request: null
        },
        mounted() {
            this.main_img = document.querySelector('#main-img');
        },
        methods: {
            isMobile() {
                return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
            },
            openDialog() {

            },
            getBase64Image(img) {
                let canvas = document.createElement("canvas");
                canvas.width = img.width;
                canvas.height = img.height;
                let ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0, img.width, img.height);
                return canvas.toDataURL("image/png")
            },
            onImageLoad() {
                console.log("image loaded");
                this.main_img = document.querySelector('#main-img');
                let base64 = this.getBase64Image(this.main_img);
                if (this.request) {
                    clearTimeout(this.request);
                }
                this.request = setTimeout(() => {
                    (async () => {
                        await this.predict(base64)
                    })()
                }, 0);
            },
            onImageLoadError() {
                console.log("image error");
                this.loading = false;
                this.$message.error('Please provide a valid image URL');
                this.current_img = null;
            },
            async loadImage(url = this.default_image[0]) {
                this.loading = true;
                this.value = 50;
                this.current_img = url;
            },
            sleep(time) {
                return new Promise((resolve) => setTimeout(resolve, time))
            },
            async predict(base64) {
                // await this.sleep(2000);
                try {
                    let data = {
                        'image': base64
                    }
                    let res = await fetch(this.backend_url, {
                            method: 'POST',
                            mode: 'cors',
                            headers: {
                                'content-type': 'application/json'
                            },
                            body: JSON.stringify(data)
                        }
                    )
                    res = await res.json()
                    console.log(res)
                    if (res.status === 0) {
                        // success
                        this.value = parseFloat(res.msg) * 100;
                    } else {
                        // error
                        this.$message.error(res.msg);
                    }
                } catch (e) {
                    console.log('loadImage', e)
                    this.$message.error('Something error');
                } finally {
                    this.loading = false;
                }
            }
        }
    })
</script>
<style lang="scss">
    .available-button {
        padding: 0;
        margin: 10px;
        height: 80px;
        width: 80px;
    }

    .select-button {
      border: 0;
    }

    .available-img {
        width: 80px;
        height: 80px;
    }

    .available-img img {
      padding: 0;
    }

    .main-img {
        height: calc(80vh - 450px);
        margin: 5vh 10px 5vh 10px;
    }

    .block {
        display: flex;
    }

    .block .slider {
        flex-grow: 4;
    }

    .block .tag {
        flex-grow: 1;
        text-align: center;
        font-size: xxx-large;
        font-size: -webkit-xxx-large;
    }

    .slider {
        pointer-events: none;
    }

    .el-slider__bar {
        background-color: #e4e7ed;
    }

    .img-selector {
        display: flex;
        justify-content: flex-start;
        width: 100%;
        overflow-x: auto;
    }

    .dialog-footer button {
        font-size: 18px;
    }

    .el-dialog__body input {
        font-size: 18px;
    }

    .el-empty__description p{
        font-size: 18px;
        margin-bottom: 10px;
    }

    .el-empty {
      flex-direction: column-reverse
    }
</style>
</body>
</html>
